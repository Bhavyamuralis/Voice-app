<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Offline Transaction Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 20px; }
    form { margin-bottom: 20px; }
    input, button { padding: 10px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    .actions { display: flex; justify-content: space-between; margin-top: 20px; }
    button { font-size: 16px; border-radius: 12px; }
    #voice, #add { flex: 1; margin: 5px; }
  </style>
</head>
<body>
  <h2>Offline Transaction Tracker</h2>
  
  <form id="transactionForm">
    <input type="date" id="date" required>
    <input type="text" id="description" placeholder="Description" required>
    <input type="number" id="amount" placeholder="Amount" required>
    <div class="actions">
      <button type="button" id="voice">üé§ Voice</button>
      <button type="submit" id="add">‚ûï Add</button>
    </div>
  </form>
  
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody id="transactions"></tbody>
  </table>

  <script>
    let db, editId=null;

    // Open IndexedDB
    const request = indexedDB.open("TransactionDB", 1);
    request.onupgradeneeded = e => {
      let db = e.target.result;
      db.createObjectStore("transactions", { keyPath: "id", autoIncrement: true });
    };
    request.onsuccess = e => {
      db = e.target.result;
      displayTransactions();
    };

    // Add / Update transaction
    document.getElementById("transactionForm").onsubmit = function(e){
      e.preventDefault();
      let date = document.getElementById("date").value;
      let description = document.getElementById("description").value;
      let amount = parseFloat(document.getElementById("amount").value);
      let tx = db.transaction("transactions", "readwrite");
      let store = tx.objectStore("transactions");
      if(editId){
        store.put({id:editId, date, description, amount});
        editId=null;
        document.querySelector("button[type='submit']").textContent="‚ûï Add";
      } else {
        store.add({date, description, amount});
      }
      tx.oncomplete=displayTransactions;
      this.reset();
    };

    // Display records
    function displayTransactions(){
      let tbody = document.getElementById("transactions");
      tbody.innerHTML="";
      let tx = db.transaction("transactions", "readonly");
      let store = tx.objectStore("transactions");
      store.openCursor().onsuccess = function(e){
        let cursor = e.target.result;
        if(cursor){
          let tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${cursor.value.date}</td>
            <td>${cursor.value.description}</td>
            <td>${cursor.value.amount.toFixed(2)}</td>
          `;
          // attach swipe events with its own record
          addSwipeHandlers(tr, cursor.value);
          tbody.appendChild(tr);
          cursor.continue();
        }
      };
    }

    // Swipe to Edit/Delete
    function addSwipeHandlers(row, data){
      let startX=0;
      row.addEventListener("touchstart", e=>{
        startX=e.changedTouches[0].screenX;
      });
      row.addEventListener("touchend", e=>{
        let endX=e.changedTouches[0].screenX;
        if(endX-startX > 50){ // swipe right -> edit
          editTransaction(data);
        } else if(startX-endX > 50){ // swipe left -> delete
          deleteTransaction(data.id);
        }
      });
    }

    // Edit
    function editTransaction(data){
      document.getElementById("date").value = data.date;
      document.getElementById("description").value = data.description;
      document.getElementById("amount").value = data.amount;
      editId = data.id;
      document.querySelector("button[type='submit']").textContent="‚úèÔ∏è Update";
    }

    // Delete
    function deleteTransaction(id){
      let tx = db.transaction("transactions", "readwrite");
      tx.objectStore("transactions").delete(id);
      tx.oncomplete=displayTransactions;
    }

    // Voice Input (only for description)
    document.getElementById("voice").onclick=function(){
      if(!('webkitSpeechRecognition' in window)){ alert("Not supported"); return;}
      let rec = new webkitSpeechRecognition();
      rec.lang="te-IN"; // Telugu input
      rec.start();
      rec.onresult=function(e){
        document.getElementById("description").value = e.results[0][0].transcript;
      };
    };
  </script>
</body>
</html>
