<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Tracker</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #f7f7f7;
    }
    h2 { text-align: center; }
    .input-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
    }
    input {
        padding: 10px;
        font-size: 16px;
        flex: 1;
        margin-right: 10px;
    }
    .buttons {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
    }
    button {
        padding: 15px;
        font-size: 18px;
        flex: 1;
        margin: 5px;
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
    }
    #addBtn { background: #28a745; }
    #voiceBtn { background: #007bff; }
    #exportBtn { background: #ff9800; }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: white;
    }
    th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
    }
    th { background: #f2f2f2; }
    tr.swipe-left { background: #f8d7da; transition: 0.3s; }
    tr.swipe-right { background: #d4edda; transition: 0.3s; }
    .total {
        margin-top: 15px;
        font-size: 18px;
        font-weight: bold;
        text-align: right;
    }
</style>
</head>
<body>

<h2>ðŸ“’ Expense Tracker</h2>

<div class="input-row">
    <input type="text" id="description" placeholder="Enter description">
    <input type="number" id="amount" placeholder="Amount">
</div>

<div class="buttons">
    <button id="voiceBtn" onclick="startVoiceInput()">ðŸŽ¤ Voice</button>
    <button id="addBtn" onclick="addEntry()">âž• Add</button>
</div>

<button id="exportBtn" onclick="exportCSV()">ðŸ“¤ Export CSV</button>

<table id="expenseTable">
    <thead>
        <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Amount</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div class="total">Total: â‚¹<span id="total">0</span></div>

<script>
let expenses = [];
let editIndex = null;

// Add or Edit entry
function addEntry() {
    let desc = document.getElementById("description").value.trim();
    let amt = parseFloat(document.getElementById("amount").value);
    if (!desc || isNaN(amt)) return alert("Enter description and valid amount");

    let today = new Date().toISOString().split("T")[0];
    let entry = { date: today, description: desc, amount: amt };

    if (editIndex !== null) {
        expenses[editIndex] = entry;
        editIndex = null;
    } else {
        expenses.push(entry);
    }

    document.getElementById("description").value = "";
    document.getElementById("amount").value = "";
    renderTable();
}

// Render table with swipe gestures
function renderTable() {
    let tbody = document.querySelector("#expenseTable tbody");
    tbody.innerHTML = "";

    expenses.forEach((exp, index) => {
        let row = document.createElement("tr");
        row.innerHTML = `
            <td>${exp.date}</td>
            <td>${exp.description}</td>
            <td>â‚¹${exp.amount.toFixed(2)}</td>
        `;

        let startX = 0;
        row.addEventListener("touchstart", e => { startX = e.touches[0].clientX; });
        row.addEventListener("touchend", e => {
            let endX = e.changedTouches[0].clientX;
            if (startX - endX > 100) { // Swipe Left = Delete
                row.classList.add("swipe-left");
                setTimeout(() => { deleteEntry(index); }, 300);
            } else if (endX - startX > 100) { // Swipe Right = Edit
                row.classList.add("swipe-right");
                setTimeout(() => { editEntry(index); }, 300);
            }
        });

        tbody.appendChild(row);
    });

    updateTotal();
}

function deleteEntry(index) {
    expenses.splice(index, 1);
    renderTable();
}

function editEntry(index) {
    document.getElementById("description").value = expenses[index].description;
    document.getElementById("amount").value = expenses[index].amount;
    editIndex = index;
}

function updateTotal() {
    let total = expenses.reduce((sum, e) => sum + e.amount, 0);
    document.getElementById("total").textContent = total.toFixed(2);
}

// Export to CSV
function exportCSV() {
    let csv = "Date,Description,Amount\n";
    expenses.forEach(e => {
        csv += `${e.date},${e.description},${e.amount}\n`;
    });

    let blob = new Blob([csv], { type: "text/csv" });
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "expenses.csv";
    link.click();
}

// Voice Input with Telugu/English fallback
function startVoiceInput() {
    if (!('webkitSpeechRecognition' in window)) {
        alert("Sorry, your browser does not support voice input.");
        return;
    }

    const recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;

    // Detect device language, fallback to English
    let userLang = navigator.language || "en-US";
    if (userLang !== "te-IN" && userLang !== "en-IN") {
        userLang = "en-US";
    }
    recognition.lang = userLang;

    recognition.onstart = () => console.log("ðŸŽ¤ Listening...");
    recognition.onerror = (event) => {
        console.error("Voice error:", event.error);
        alert("Voice recognition error: " + event.error);
    };
    recognition.onresult = (event) => {
        let transcript = event.results[0][0].transcript;
        document.getElementById("description").value = transcript;
    };
    recognition.onend = () => console.log("ðŸŽ¤ Stopped listening");

    recognition.start();
}
</script>

</body>
</html>
