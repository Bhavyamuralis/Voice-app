<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expense Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
    #controls { display: flex; gap: 10px; margin-bottom: 15px; }
    button { flex: 1; border: none; border-radius: 8px; }
    #addBtn { background: green; color: white; font-size: 18px; }
    #voiceBtn { background: blue; color: white; font-size: 18px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    tr.swipe-right { background: #e0f7fa; transition: background 0.3s; }
    tr.swipe-left { background: #ffebee; transition: background 0.3s; }
    #total { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>

  <h2>Expense Tracker</h2>
  <input type="date" id="date">
  <input type="text" id="description" placeholder="Description">
  <input type="number" id="amount" placeholder="Amount">

  <div id="controls">
    <button id="addBtn">âž• Add</button>
    <button id="voiceBtn">ðŸŽ¤ Voice</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody id="dataBody"></tbody>
  </table>

  <div id="total">Total: 0</div>

<script>
let data = JSON.parse(localStorage.getItem("expenses") || "[]");
let editingIndex = -1; // track which record is being edited

// set today date default
document.getElementById("date").valueAsDate = new Date();

function saveData() {
  localStorage.setItem("expenses", JSON.stringify(data));
}

function renderTable() {
  const body = document.getElementById("dataBody");
  body.innerHTML = "";
  let total = 0;

  data.forEach((item, index) => {
    let row = document.createElement("tr");
    row.innerHTML = `
      <td>${item.date}</td>
      <td>${item.description}</td>
      <td>${item.amount}</td>
    `;

    // swipe detection
    let startX;
    row.addEventListener("touchstart", e => {
      startX = e.changedTouches[0].screenX;
    });

    row.addEventListener("touchend", e => {
      let endX = e.changedTouches[0].screenX;
      let diff = endX - startX;
      if (diff > 50) { // swipe right = edit
        row.classList.add("swipe-right");
        setTimeout(() => row.classList.remove("swipe-right"), 500);
        editEntry(index);
      } else if (diff < -50) { // swipe left = delete
        row.classList.add("swipe-left");
        setTimeout(() => {
          data.splice(index, 1);
          saveData();
          renderTable();
        }, 300);
      }
    });

    body.appendChild(row);
    total += parseFloat(item.amount);
  });

  document.getElementById("total").innerText = "Total: " + total.toFixed(2);
}

function addEntry() {
  let date = document.getElementById("date").value;
  let desc = document.getElementById("description").value.trim();
  let amount = parseFloat(document.getElementById("amount").value);

  if (!desc || isNaN(amount)) {
    alert("Enter description and amount!");
    return;
  }

  if (editingIndex >= 0) {
    // update existing record
    data[editingIndex] = { date, description: desc, amount };
    editingIndex = -1;
  } else {
    // new record
    data.push({ date, description: desc, amount });
  }

  saveData();
  renderTable();

  // reset inputs
  document.getElementById("description").value = "";
  document.getElementById("amount").value = "";
}

function editEntry(index) {
  let item = data[index];
  document.getElementById("date").value = item.date;
  document.getElementById("description").value = item.description;
  document.getElementById("amount").value = item.amount;
  editingIndex = index;
}

// voice input
document.getElementById("voiceBtn").addEventListener("click", () => {
  if (!('webkitSpeechRecognition' in window)) {
    alert("Voice recognition not supported in this browser.");
    return;
  }
  const recognition = new webkitSpeechRecognition();
  recognition.lang = "te-IN"; // Telugu input
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.start();

  recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    document.getElementById("description").value = transcript;
  };

  recognition.onerror = function() {
    alert("Voice recognition error");
  };
});

document.getElementById("addBtn").addEventListener("click", addEntry);

renderTable();
</script>
</body>
</html>
