<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expense Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 15px; }
    h2 { text-align: center; }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    tr { transition: transform 0.3s ease; }
    .button-row { display: flex; justify-content: space-between; margin-top: 10px; }
    .big-btn { flex: 1; font-size: 20px; padding: 15px; margin: 5px; }
    .edit-highlight { background-color: #ffff99; }
  </style>
</head>
<body>
  <h2>ðŸ“’ Expense Tracker</h2>

  <label>Date:</label>
  <input type="date" id="date"><br>
  <label>Description:</label>
  <input type="text" id="description"><br>
  <label>Amount:</label>
  <input type="number" id="amount"><br>

  <div class="button-row">
    <button id="addBtn" class="big-btn">âž• Add</button>
    <button id="voiceBtn" class="big-btn">ðŸŽ¤ Voice</button>
  </div>
  <button onclick="exportCSV()">ðŸ“¤ Export CSV</button>

  <table id="dataTable">
    <thead>
      <tr><th>Date</th><th>Description</th><th>Amount</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr><td colspan="2"><b>Total</b></td><td id="total">0</td></tr>
    </tfoot>
  </table>

  <script>
    let editId = null; // track which row is being edited

    document.getElementById("date").value = new Date().toISOString().split("T")[0];

    function loadData() {
      let data = JSON.parse(localStorage.getItem("expenses") || "[]");
      let tbody = document.querySelector("#dataTable tbody");
      tbody.innerHTML = "";
      let total = 0;

      data.forEach(item => {
        let tr = document.createElement("tr");
        tr.dataset.id = item.id; // assign ID to row
        tr.innerHTML = `<td>${item.date}</td><td>${item.description}</td><td>${item.amount}</td>`;
        tbody.appendChild(tr);
        total += parseFloat(item.amount);
        addSwipe(tr);
      });

      document.getElementById("total").innerText = total.toFixed(2);
    }

    function saveData(date, description, amount) {
      let data = JSON.parse(localStorage.getItem("expenses") || "[]");

      if (editId) {
        // update existing record
        let index = data.findIndex(x => x.id === editId);
        if (index !== -1) {
          data[index] = { id: editId, date, description, amount };
        }
        editId = null;
        document.getElementById("addBtn").innerText = "âž• Add";
      } else {
        // add new record
        let id = Date.now().toString();
        data.push({ id, date, description, amount });
      }

      localStorage.setItem("expenses", JSON.stringify(data));
      loadData();
    }

    document.getElementById("addBtn").addEventListener("click", () => {
      let date = document.getElementById("date").value;
      let description = document.getElementById("description").value;
      let amount = document.getElementById("amount").value;
      if (!description || !amount) return alert("Enter description & amount");
      saveData(date, description, amount);
      document.getElementById("description").value = "";
      document.getElementById("amount").value = "";
    });

    function addSwipe(row) {
      let touchstartX = 0;
      let touchendX = 0;
      row.addEventListener("touchstart", e => touchstartX = e.changedTouches[0].screenX);
      row.addEventListener("touchend", e => {
        touchendX = e.changedTouches[0].screenX;
        if (touchendX < touchstartX - 50) { // left swipe = delete
          let id = row.dataset.id;
          let data = JSON.parse(localStorage.getItem("expenses") || "[]");
          data = data.filter(x => x.id !== id);
          localStorage.setItem("expenses", JSON.stringify(data));
          loadData();
        } else if (touchendX > touchstartX + 50) { // right swipe = edit
          let id = row.dataset.id;
          let data = JSON.parse(localStorage.getItem("expenses") || "[]");
          let record = data.find(x => x.id === id);
          if (record) {
            document.getElementById("date").value = record.date;
            document.getElementById("description").value = record.description;
            document.getElementById("amount").value = record.amount;
            editId = record.id;
            document.getElementById("addBtn").innerText = "âœï¸ Update";
          }
        }
      });
    }

    function exportCSV() {
      let data = JSON.parse(localStorage.getItem("expenses") || "[]");
      if (data.length === 0) return alert("No data to export");
      let csv = "Date,Description,Amount\n";
      data.forEach(item => {
        csv += `${item.date},${item.description},${item.amount}\n`;
      });
      let blob = new Blob([csv], { type: "text/csv" });
      let url = URL.createObjectURL(blob);
      let a = document.createElement("a");
      a.href = url;
      a.download = "expenses.csv";
      a.click();
    }

    // ðŸŽ¤ Voice input
    document.getElementById("voiceBtn").addEventListener("click", () => {
      if (!("webkitSpeechRecognition" in window)) {
        alert("Voice not supported in this browser");
        return;
      }
      let recognition = new webkitSpeechRecognition();
      recognition.lang = "te-IN"; // Telugu input
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.start();
      recognition.onresult = event => {
        document.getElementById("description").value = event.results[0][0].transcript;
      };
    });

    loadData();
  </script>
</body>
</html>
