<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Expense Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 15px; text-align: center; }
    h2 { margin: 10px 0; }
    select, button { font-size: 18px; padding: 10px; margin: 8px; border-radius: 10px; }
    #log { margin-top: 20px; font-size: 14px; color: green; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #eee; }
    .hidden { display: none; }
  </style>
</head>
<body>

  <h2>Smart Expense Tracker</h2>

  <!-- Step 1: Account Selection -->
  <div id="accountDiv">
    <h3>Select Account</h3>
    <select id="accountSelect">
      <option value="Cash">Cash</option>
      <option value="Bank">Bank</option>
      <option value="Card">Card</option>
    </select>
    <button onclick="setDefaultAccount()">Set Default</button>
  </div>

  <!-- Step 2: Category -->
  <div id="categoryDiv" class="hidden">
    <h3>Select Category</h3>
    <select id="categorySelect" onchange="showSubcategories()">
      <option value="">--Select--</option>
      <option value="Food">Food</option>
      <option value="Transport">Transport</option>
      <option value="Shopping">Shopping</option>
      <option value="Bills">Bills</option>
    </select>
  </div>

  <!-- Step 3: Subcategory -->
  <div id="subcategoryDiv" class="hidden">
    <h3>Select Subcategory</h3>
    <select id="subcategorySelect" onchange="startVoiceInput()"></select>
  </div>

  <div id="log"></div>

  <!-- Table -->
  <table id="expenseTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Account</th>
        <th>Category</th>
        <th>Subcategory</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let recognition;
    let expenses = [];

    // Predefined subcategories
    const subcategories = {
      "Food": ["Breakfast", "Lunch", "Dinner", "Snacks"],
      "Transport": ["Bus", "Train", "Taxi", "Fuel"],
      "Shopping": ["Clothes", "Groceries", "Electronics"],
      "Bills": ["Electricity", "Water", "Internet"]
    };

    // Load default account on page load
    window.onload = function() {
      const defaultAcc = localStorage.getItem("defaultAccount");
      if (defaultAcc) {
        document.getElementById("accountSelect").value = defaultAcc;
        document.getElementById("accountDiv").classList.add("hidden");
        document.getElementById("categoryDiv").classList.remove("hidden");
      }
    };

    function setDefaultAccount() {
      const acc = document.getElementById("accountSelect").value;
      localStorage.setItem("defaultAccount", acc);
      document.getElementById("accountDiv").classList.add("hidden");
      document.getElementById("categoryDiv").classList.remove("hidden");
    }

    function showSubcategories() {
      const cat = document.getElementById("categorySelect").value;
      const subSelect = document.getElementById("subcategorySelect");
      subSelect.innerHTML = "";
      if (cat && subcategories[cat]) {
        subcategories[cat].forEach(sc => {
          const opt = document.createElement("option");
          opt.value = sc; opt.textContent = sc;
          subSelect.appendChild(opt);
        });
        document.getElementById("subcategoryDiv").classList.remove("hidden");
      } else {
        document.getElementById("subcategoryDiv").classList.add("hidden");
      }
    }

    // Start voice input after subcategory select
    function startVoiceInput() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("Voice recognition not supported in this browser.");
        return;
      }
      recognition = new SpeechRecognition();
      recognition.lang = "en-IN"; // Change if you want Telugu: "te-IN"
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.start();
      document.getElementById("log").textContent = "ðŸŽ¤ Speak description and amount...";

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        processVoiceInput(transcript);
      };

      recognition.onerror = (event) => {
        document.getElementById("log").textContent = "Error: " + event.error;
      };

      recognition.onend = () => {
        document.getElementById("log").textContent += " (Stopped)";
      };
    }

    // Extract description & amount
    function processVoiceInput(transcript) {
      let amountMatch = transcript.match(/(\d+(\.\d+)?)/);
      let amount = amountMatch ? amountMatch[0] : "0";
      let description = transcript.replace(amount, "").trim();

      const acc = localStorage.getItem("defaultAccount");
      const cat = document.getElementById("categorySelect").value;
      const subcat = document.getElementById("subcategorySelect").value;

      const date = new Date().toLocaleDateString();

      expenses.push({date, acc, cat, subcat, description, amount});
      updateTable();

      // Reset flow: show category again
      document.getElementById("subcategoryDiv").classList.add("hidden");
      document.getElementById("categorySelect").value = "";
    }

    function updateTable() {
      const tbody = document.querySelector("#expenseTable tbody");
      tbody.innerHTML = "";
      expenses.forEach(exp => {
        const row = `<tr>
          <td>${exp.date}</td>
          <td>${exp.acc}</td>
          <td>${exp.cat}</td>
          <td>${exp.subcat}</td>
          <td>${exp.description}</td>
          <td>${exp.amount}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }
  </script>
</body>
</html>
