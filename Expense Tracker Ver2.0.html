<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expense Tracker with Voice</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 15px; background: #f5f5f5; }
    h2 { text-align: center; }
    .hidden { display: none; }
    .btn { padding: 15px; margin: 8px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }
    .category-btn { background: #4CAF50; color: white; width: 100%; }
    .subcategory-btn { background: #2196F3; color: white; width: 100%; }
    #status { margin: 10px 0; font-weight: bold; text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: center; }
    th { background: #333; color: white; }
  </style>
</head>
<body>

  <h2>Expense Tracker</h2>

  <!-- Category Selection -->
  <div id="category-section">
    <h3>Select Category</h3>
    <div id="category-list"></div>
  </div>

  <!-- Subcategory Selection -->
  <div id="subcategory-section" class="hidden">
    <h3>Select Subcategory</h3>
    <div id="subcategory-list"></div>
  </div>

  <p id="status"></p>

  <!-- Table -->
  <h3>Saved Records</h3>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Category</th>
        <th>Subcategory</th>
        <th>Description</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody id="records"></tbody>
    <tfoot>
      <tr>
        <td colspan="4"><strong>Total</strong></td>
        <td id="total">0</td>
      </tr>
    </tfoot>
  </table>

<script>
  // Categories and Subcategories
  const categories = {
    "Food": ["Groceries", "Restaurants", "Snacks"],
    "Transport": ["Fuel", "Bus", "Taxi"],
    "Shopping": ["Clothes", "Electronics", "Others"],
    "Bills": ["Electricity", "Water", "Internet"]
  };

  let selectedCategory = "";
  let selectedSubcategory = "";

  // Initialize
  function loadCategories() {
    const list = document.getElementById("category-list");
    list.innerHTML = "";
    for (let cat in categories) {
      const btn = document.createElement("button");
      btn.className = "btn category-btn";
      btn.textContent = cat;
      btn.onclick = () => selectCategory(cat);
      list.appendChild(btn);
    }
    document.getElementById("category-section").classList.remove("hidden");
    document.getElementById("subcategory-section").classList.add("hidden");
  }

  function selectCategory(cat) {
    selectedCategory = cat;
    document.getElementById("category-section").classList.add("hidden");
    const list = document.getElementById("subcategory-list");
    list.innerHTML = "";
    categories[cat].forEach(sub => {
      const btn = document.createElement("button");
      btn.className = "btn subcategory-btn";
      btn.textContent = sub;
      btn.onclick = () => selectSubcategory(sub);
      list.appendChild(btn);
    });
    document.getElementById("subcategory-section").classList.remove("hidden");
  }

  function selectSubcategory(sub) {
    selectedSubcategory = sub;
    document.getElementById("subcategory-section").classList.add("hidden");
    startVoiceInput();
  }

  // Voice Recognition
  function startVoiceInput() {
    if (!('webkitSpeechRecognition' in window)) {
      alert("Your browser does not support speech recognition.");
      return;
    }
    const recognition = new webkitSpeechRecognition();
    recognition.lang = "en-IN"; // you can change to "te-IN" for Telugu
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    document.getElementById("status").textContent = "ðŸŽ¤ Listening... Speak description and amount (e.g., 'Milk 50')";

    recognition.start();

    recognition.onresult = function(event) {
      const speechResult = event.results[0][0].transcript;
      document.getElementById("status").textContent = "Heard: " + speechResult;

      // Try splitting description and amount
      let words = speechResult.trim().split(" ");
      let amount = parseFloat(words.pop()); // last word as amount
      if (isNaN(amount)) {
        amount = 0;
      }
      let description = words.join(" ");

      saveRecord(description, amount);
    };

    recognition.onerror = function(event) {
      document.getElementById("status").textContent = "Error: " + event.error;
      loadCategories();
    };

    recognition.onend = function() {
      if (document.getElementById("status").textContent.startsWith("Heard:")) {
        setTimeout(loadCategories, 1000); // reload category after save
      }
    };
  }

  // Save Data
  function saveRecord(description, amount) {
    const date = new Date().toLocaleDateString();
    const record = { date, category: selectedCategory, subcategory: selectedSubcategory, description, amount };
    let records = JSON.parse(localStorage.getItem("records") || "[]");
    records.push(record);
    localStorage.setItem("records", JSON.stringify(records));
    renderRecords();
  }

  function renderRecords() {
    let records = JSON.parse(localStorage.getItem("records") || "[]");
    const tbody = document.getElementById("records");
    tbody.innerHTML = "";
    let total = 0;
    records.forEach(r => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${r.date}</td><td>${r.category}</td><td>${r.subcategory}</td><td>${r.description}</td><td>${r.amount}</td>`;
      tbody.appendChild(tr);
      total += parseFloat(r.amount);
    });
    document.getElementById("total").textContent = total;
  }

  // Init load
  loadCategories();
  renderRecords();
</script>

</body>
</html>