<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UPI Payment Scanner</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
video { width: 100%; max-width: 400px; margin: 10px auto; border: 2px solid #4CAF50; border-radius: 10px; }
input, button { margin: 8px; padding: 10px; width: 90%; max-width: 400px; border-radius: 6px; border: 1px solid #ccc; }
.transactions { margin-top: 20px; text-align: left; }
.tx { background: #f0f0f0; margin: 5px 0; padding: 8px; border-radius: 6px; }
</style>
<link rel="manifest" href="data:application/manifest+json,{&quot;name&quot;:&quot;UPI Payment Scanner&quot;,&quot;short_name&quot;:&quot;UPI Pay&quot;,&quot;start_url&quot;:&quot;./&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#ffffff&quot;,&quot;theme_color&quot;:&quot;#4CAF50&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;icon.png&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/png&quot;}]}">
</head>
<body>
<h2>ðŸ“· UPI Payment Scanner</h2>
<video id="preview" autoplay></video><br>
<input type="text" id="upiId" placeholder="UPI ID"><br>
<input type="text" id="name" placeholder="Payee Name"><br>
<input type="number" id="amount" placeholder="Enter Amount"><br>
<input type="text" id="desc" placeholder="Description"><br>
<button id="payBtn">ðŸ’³ Pay Now</button>

<h3>Saved Transactions</h3>
<div class="transactions" id="txList"></div>

<script src="https://unpkg.com/qr-scanner/qr-scanner.umd.min.js"></script>
<script>
// Service Worker in same file
if ('serviceWorker' in navigator) {
  const swCode = `
  self.addEventListener('install', e => {
    e.waitUntil(caches.open('upi-app').then(c => c.addAll(['./'])));
  });
  self.addEventListener('fetch', e => {
    e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
  });`;
  const blob = new Blob([swCode], {type: 'application/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(blob));
}

// Transaction handling
const txList = document.getElementById('txList');
function loadTransactions() {
  const txs = JSON.parse(localStorage.getItem('transactions')||'[]');
  txList.innerHTML = '';
  txs.forEach(t => {
    const div = document.createElement('div');
    div.className = 'tx';
    div.innerText = `${t.name} (${t.upi}) - â‚¹${t.amount} : ${t.desc}`;
    txList.appendChild(div);
  });
}
function saveTransaction(upi, name, amount, desc) {
  const txs = JSON.parse(localStorage.getItem('transactions')||'[]');
  txs.push({upi,name,amount,desc,date:new Date().toLocaleString()});
  localStorage.setItem('transactions', JSON.stringify(txs));
  loadTransactions();
}
loadTransactions();

// QR Scanner
const video = document.getElementById('preview');
const scanner = new QrScanner(video, result => {
  if(result.startsWith("upi://")) {
    const params = new URLSearchParams(result.split('?')[1]);
    document.getElementById('upiId').value = params.get('pa')||'';
    document.getElementById('name').value = params.get('pn')||'';
    document.getElementById('amount').value = params.get('am')||'';
    document.getElementById('desc').value = params.get('tn')||'';
  }
});
scanner.start();

// Pay button
document.getElementById('payBtn').onclick = () => {
  const upi = document.getElementById('upiId').value.trim();
  const name = document.getElementById('name').value.trim();
  const amount = document.getElementById('amount').value.trim();
  const desc = document.getElementById('desc').value.trim();
  if(!upi || !amount){ alert("UPI ID & Amount required"); return;}
  saveTransaction(upi,name,amount,desc);
  const url = `upi://pay?pa=${upi}&pn=${encodeURIComponent(name)}&am=${amount}&cu=INR&tn=${encodeURIComponent(desc)}`;
  window.location.href = url;
};
</script>
</body>
</html>