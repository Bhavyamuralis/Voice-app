<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Tracker</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
  header { background: #4CAF50; color: white; padding: 12px; text-align: center; font-size: 20px; }
  .container { padding: 10px; }
  .btn { display: block; width: 100%; padding: 15px; margin: 8px 0;
         border: none; border-radius: 10px; font-size: 18px; color: white; cursor: pointer; }
  .category { background: #2196F3; }
  .subcategory { background: #FF9800; }
  .back-btn { background: #9C27B0; }
  #recordsTable { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 10px; overflow: hidden; }
  #recordsTable th, #recordsTable td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; }
  #recordsTable th { background: #eee; }
  .total { text-align: right; font-weight: bold; margin: 12px 5px; font-size: 18px; }
  .toolbar { display: flex; justify-content: space-between; align-items: center; margin: 10px; }
  .switch, .lang-btn { cursor: pointer; padding: 8px 15px; border-radius: 20px; border: none; }
  .switch { background: #607D8B; color: white; }
  .lang-btn { background: #795548; color: white; }
  .swipe { transition: transform 0.3s ease; }
</style>
</head>
<body>
<header>Expense Tracker</header>

<div class="toolbar">
  <button class="lang-btn" id="langBtn">Language: Telugu</button>
  <button class="switch" id="stayToggle">Stay ON</button>
</div>

<div class="container" id="categoryView"></div>
<div class="container" id="subcategoryView" style="display:none"></div>
<div class="container" id="recordsView">
  <h3>Records</h3>
  <table id="recordsTable">
    <thead>
      <tr>
        <th>Date</th><th>Category</th><th>Subcategory</th><th>Description</th><th>Amount</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div class="total" id="totalDisplay">Total: 0</div>
</div>

<script>
let categories = {
  "Food": ["Breakfast", "Lunch", "Dinner", "Snacks"],
  "Transport": ["Bus", "Auto", "Cab", "Fuel"],
  "Shopping": ["Clothes", "Groceries", "Electronics"],
  "Bills": ["Electricity", "Water", "Mobile", "Internet"]
};

let currentCategory = "";
let currentLang = "te-IN"; // default Telugu
let stayOn = false;

document.getElementById("stayToggle").addEventListener("click", () => {
  stayOn = !stayOn;
  document.getElementById("stayToggle").innerText = stayOn ? "Stay ON" : "Stay OFF";
});

document.getElementById("langBtn").addEventListener("click", () => {
  currentLang = currentLang === "te-IN" ? "en-US" : "te-IN";
  document.getElementById("langBtn").innerText = "Language: " + (currentLang === "te-IN" ? "Telugu" : "English");
});

function showCategories() {
  let html = "<h3>Select Category</h3>";
  for (let cat in categories) {
    html += `<button class="btn category" onclick="showSubcategories('${cat}')">${cat}</button>`;
  }
  document.getElementById("categoryView").innerHTML = html;
  document.getElementById("categoryView").style.display = "block";
  document.getElementById("subcategoryView").style.display = "none";
}
function showSubcategories(cat) {
  currentCategory = cat;
  let html = `<h3>${cat} - Select Subcategory</h3>`;
  categories[cat].forEach(sub => {
    html += `<button class="btn subcategory" onclick="startVoice('${sub}')">${sub}</button>`;
  });
  html += `<button class="btn back-btn" onclick="showCategories()">â¬… Back</button>`;
  document.getElementById("subcategoryView").innerHTML = html;
  document.getElementById("subcategoryView").style.display = "block";
  document.getElementById("categoryView").style.display = "none";
}

function startVoice(subcat) {
  let recognition = new webkitSpeechRecognition();
  recognition.lang = currentLang;
  recognition.start();

  recognition.onresult = function(e) {
    let transcript = e.results[0][0].transcript.trim();
    let parts = transcript.split(" ");
    let amount = parseFloat(parts.pop()) || 0;
    let description = parts.join(" ");
    saveRecord(currentCategory, subcat, description, amount);
    if (!stayOn) showCategories();
  };
}

function saveRecord(cat, subcat, desc, amt) {
  let records = JSON.parse(localStorage.getItem("expenses") || "[]");
  records.push({date: new Date().toLocaleDateString(), category: cat, subcategory: subcat, description: desc, amount: amt});
  localStorage.setItem("expenses", JSON.stringify(records));
  loadRecords();
}

function loadRecords() {
  let records = JSON.parse(localStorage.getItem("expenses") || "[]");
  let tbody = document.querySelector("#recordsTable tbody");
  tbody.innerHTML = "";
  let total = 0;
  records.forEach((r, i) => {
    total += r.amount;
    let tr = document.createElement("tr");
    tr.classList.add("swipe");
    tr.innerHTML = `<td>${r.date}</td><td>${r.category}</td><td>${r.subcategory}</td><td>${r.description}</td><td>${r.amount}</td>`;
    addSwipeEvents(tr, i);
    tbody.appendChild(tr);
  });
  document.getElementById("totalDisplay").innerText = "Total: " + total;
}

function addSwipeEvents(row, index) {
  let startX = 0;
  row.addEventListener("touchstart", e => startX = e.touches[0].clientX);
  row.addEventListener("touchend", e => {
    let diff = e.changedTouches[0].clientX - startX;
    if (diff < -50) { // left swipe
      deleteRecord(index);
    } else if (diff > 50) { // right swipe
      editRecord(index);
    }
  });
}

function deleteRecord(i) {
  let records = JSON.parse(localStorage.getItem("expenses") || "[]");
  records.splice(i, 1);
  localStorage.setItem("expenses", JSON.stringify(records));
  loadRecords();
}

function editRecord(i) {
  let records = JSON.parse(localStorage.getItem("expenses") || "[]");
  let rec = records[i];
  let newDesc = prompt("Edit Description", rec.description);
  let newAmt = parseFloat(prompt("Edit Amount", rec.amount)) || rec.amount;
  records[i].description = newDesc;
  records[i].amount = newAmt;
  localStorage.setItem("expenses", JSON.stringify(records));
  loadRecords();
}

showCategories();
loadRecords();
</script>
</body>
</html>
