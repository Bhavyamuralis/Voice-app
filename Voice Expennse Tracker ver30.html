<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expense Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; background: #f5f5f5; }
    h2 { text-align: center; }
    .category, .subcategory, button {
      width: 100%; padding: 12px; margin: 5px 0; border: none;
      border-radius: 8px; font-size: 16px; cursor: pointer;
    }
    .category { background: #4caf50; color: white; }
    .subcategory { background: #2196f3; color: white; }
    #records { margin-top: 20px; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; background: white; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: center; }
    th { background: #333; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }
    .total { font-weight: bold; background: #eee; }
    #toggleReload {
      display: block; width: 100%; padding: 10px; margin: 10px 0;
      background: #ff9800; color: white; border: none; border-radius: 8px;
      font-size: 16px; cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Expense Tracker</h2>
  <button id="toggleReload">Auto Reload: ON</button>
  <div id="categories"></div>
  <div id="subcategories"></div>
  <div id="records"></div>

  <script>
    const categories = {
      "Food": ["Breakfast", "Lunch", "Dinner", "Snacks"],
      "Transport": ["Bus", "Train", "Taxi", "Fuel"],
      "Shopping": ["Clothes", "Electronics", "Groceries"],
      "Bills": ["Electricity", "Water", "Internet", "Mobile"]
    };

    let selectedCategory = "";
    let selectedSubcategory = "";
    let autoReload = true; // default ON

    // Render categories
    function showCategories() {
      document.getElementById("categories").innerHTML = "";
      document.getElementById("subcategories").innerHTML = "";
      for (let cat in categories) {
        let btn = document.createElement("button");
        btn.innerText = cat;
        btn.className = "category";
        btn.onclick = () => showSubcategories(cat);
        document.getElementById("categories").appendChild(btn);
      }
    }

    // Render subcategories
    function showSubcategories(category) {
      selectedCategory = category;
      document.getElementById("subcategories").innerHTML = "";
      categories[category].forEach(sub => {
        let btn = document.createElement("button");
        btn.innerText = sub;
        btn.className = "subcategory";
        btn.onclick = () => startVoiceInput(sub);
        document.getElementById("subcategories").appendChild(btn);
      });
    }

    // Start mic input
    function startVoiceInput(subcategory) {
      selectedSubcategory = subcategory;
      const recognition = new webkitSpeechRecognition();
      recognition.lang = "te-IN"; // Telugu default
      recognition.start();

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.trim();
        const parts = transcript.split(" ");
        const amount = parseFloat(parts.pop().replace(/[^0-9.]/g, ""));
        const description = parts.join(" ");
        if (!isNaN(amount)) {
          saveRecord(description, amount);
        } else {
          alert("Couldn't detect amount. Please try again.");
        }
      };
    }

    // Save record
    function saveRecord(description, amount) {
      const today = new Date().toISOString().split("T")[0];
      const record = { date: today, category: selectedCategory, subcategory: selectedSubcategory, description, amount };
      let records = JSON.parse(localStorage.getItem("expenses") || "[]");
      records.push(record);
      localStorage.setItem("expenses", JSON.stringify(records));
      renderRecords();
      // auto reload only if toggle is ON
      if (autoReload) {
        showCategories();
      }
    }

    // Show table
    function renderRecords() {
      let records = JSON.parse(localStorage.getItem("expenses") || "[]");
      let html = "<table><tr><th>Date</th><th>Category</th><th>Subcategory</th><th>Description</th><th>Amount</th></tr>";
      let total = 0;
      records.forEach((r, i) => {
        html += `<tr data-index="${i}">
          <td>${r.date}</td>
          <td>${r.category}</td>
          <td>${r.subcategory}</td>
          <td>${r.description}</td>
          <td>${r.amount}</td>
        </tr>`;
        total += parseFloat(r.amount);
      });
      html += `<tr class="total"><td colspan="4">Total</td><td>${total}</td></tr></table>`;
      document.getElementById("records").innerHTML = html;

      // Swipe actions
      document.querySelectorAll("#records tr").forEach(row => {
        let startX = 0;
        row.addEventListener("touchstart", e => startX = e.touches[0].clientX);
        row.addEventListener("touchend", e => {
          let endX = e.changedTouches[0].clientX;
          let index = row.getAttribute("data-index");
          if (!index) return;
          if (startX - endX > 50) { // left swipe delete
            deleteRecord(index);
          } else if (endX - startX > 50) { // right swipe edit
            editRecord(index);
          }
        });
      });
    }

    // Delete record
    function deleteRecord(index) {
      let records = JSON.parse(localStorage.getItem("expenses") || "[]");
      records.splice(index, 1);
      localStorage.setItem("expenses", JSON.stringify(records));
      renderRecords();
    }

    // Edit record
    function editRecord(index) {
      let records = JSON.parse(localStorage.getItem("expenses") || "[]");
      let rec = records[index];
      let newDesc = prompt("Edit description", rec.description);
      let newAmt = prompt("Edit amount", rec.amount);
      if (newDesc !== null && newAmt !== null && !isNaN(newAmt)) {
        records[index].description = newDesc;
        records[index].amount = parseFloat(newAmt);
        localStorage.setItem("expenses", JSON.stringify(records));
        renderRecords();
      }
    }

    // Toggle button
    document.getElementById("toggleReload").onclick = () => {
      autoReload = !autoReload;
      document.getElementById("toggleReload").innerText = `Auto Reload: ${autoReload ? "ON" : "OFF"}`;
    };

    showCategories();
    renderRecords();
  </script>
</body>
</html>
